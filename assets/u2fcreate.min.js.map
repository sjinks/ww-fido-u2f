{"version":3,"sources":["u2fcreate.js"],"names":["$","form","spinner","list","btn_submit","key_name","hint","showError","msg","where","node","document","querySelector","parentNode","removeChild","insertAdjacentHTML","showSuccess","hideMessages","showSpinner","show","classList","add","setAttribute","removeAttribute","remove","registerCompleted","noitems","this","response","status","ok","row","message","wwU2F","sigs","request","value","serverError","revokeCompleted","tgt","target","tagName","toUpperCase","killRow","getElementsByTagName","length","tpl","textContent","maybeNoItems","magic","getElementById","bind","addEventListener","e","preventDefault","reportValidity","version","challenge","u2f","register","appId","data","errorCode","errors","name","encodeURIComponent","req","XMLHttpRequest","open","ajaxurl","setRequestHeader","responseType","send","JSON","stringify","doRegister","className","indexOf","confirm","revconfirm","handle","dataset","nonce","style","float","margin","noSupport","callback","s","createElement","u2f_api","head","appendChild","readyState"],"mappings":"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","file":"u2fcreate.min.js","sourcesContent":["/** global u2f, wwU2F, ajaxurl */\n(function() {\n\tvar $, form, spinner, list, btn_submit, key_name, hint;\n\n\tfunction showError(msg, where)\n\t{\n\t\tvar node = document.querySelector('#' + where + ' + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\t$(where).insertAdjacentHTML('afterend', '<div class=\"notice notice-error inline\"><p>' + msg + '</p></div>');\n\t}\n\n\tfunction showSuccess(msg, where)\n\t{\n\t\tvar node = document.querySelector('#' + where + ' + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\t$(where).insertAdjacentHTML('afterend', '<div class=\"notice notice-success inline\"><p>' + msg + '</p></div>');\n\t}\n\n\tfunction hideMessages()\n\t{\n\t\tvar node = document.querySelector('#new-key + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\tnode = document.querySelector('#registered-keys + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t}\n\n\tfunction showSpinner(show)\n\t{\n\t\tif (show) {\n\t\t\tspinner.classList.add('is-active');\n\t\t\tbtn_submit.setAttribute('disabled', '');\n\t\t\thint.removeAttribute('hidden');\n\t\t}\n\t\telse {\n\t\t\tspinner.classList.remove('is-active');\n\t\t\tbtn_submit.removeAttribute('disabled');\n\t\t\thint.setAttribute('hidden', '');\n\t\t}\n\t}\n\n\tfunction haveNewItems()\n\t{\n\t\tvar noitems = list.querySelector('tr.no-items')\n\t\tif (noitems) {\n\t\t\tnoitems.parentNode.removeChild(noitems);\n\t\t}\n\t}\n\n\tfunction registerCompleted()\n\t{\n\t\tshowSpinner(false);\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError, 'new-key');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\thaveNewItems();\n\t\t\tlist.insertAdjacentHTML('beforeend', this.response.row);\n\t\t\tshowSuccess(this.response.message, 'new-key');\n\n\t\t\twwU2F.sigs     = this.response.sigs;\n\t\t\twwU2F.request  = this.response.request;\n\t\t\tkey_name.value = '';\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message, 'new-key');\n\t\t}\n\t}\n\n\tfunction doRegister()\n\t{\n\t\thideMessages();\n\n\t\tvar request = [{\n\t\t\tversion: wwU2F.request.version,\n\t\t\tchallenge: wwU2F.request.challenge\n\t\t}];\n\n\t\tu2f.register(wwU2F.request.appId, request, wwU2F.sigs, function(data) {\n\t\t\tif (data.errorCode) {\n\t\t\t\tvar err = wwU2F.errors[data.errorCode] || wwU2F.errors[1];\n\t\t\t\tshowError(err, 'new-key');\n\t\t\t\tshowSpinner(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar name = encodeURIComponent(key_name.value);\n\t\t\tvar req  = new XMLHttpRequest();\n\t\t\treq.addEventListener('load', registerCompleted);\n\t\t\treq.open('POST', ajaxurl);\n\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\treq.responseType = 'json';\n\t\t\treq.send('action=wwu2f_register&data=' + encodeURIComponent(JSON.stringify(data)) + '&name=' + name);\n\t\t});\n\t}\n\n\tfunction killRow(target)\n\t{\n\t\twhile (target !== null && target.tagName.toUpperCase() !== 'TR') {\n\t\t\ttarget = target.parentNode;\n\t\t}\n\n\t\ttarget && target.parentNode.removeChild(target);\n\t}\n\n\tfunction maybeNoItems()\n\t{\n\t\tif (!list.getElementsByTagName('tr').length) {\n\t\t\tvar tpl = $('tpl-empty').textContent;\n\t\t\tlist.insertAdjacentHTML('beforeend', tpl);\n\t\t}\n\t}\n\n\tfunction revokeCompleted()\n\t{\n\t\tvar spinner = this.tgt.querySelector('.spinner');\n\t\tspinner.classList.remove('is-active');\n\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError, 'registered-keys');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\tshowSuccess(this.response.message, 'registered-keys');\n\t\t\tkillRow(this.tgt);\n\t\t\tmaybeNoItems();\n\t\t\twwU2F.sigs = this.response.sigs;\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message, 'registered-keys');\n\t\t}\n\t}\n\n\tfunction magic()\n\t{\n\t\t$          = document.getElementById.bind(document);\n\t\tform       = $('new-key-form');\n\t\tspinner    = form.querySelector('.spinner');\n\t\tlist       = $('the-list');\n\t\tbtn_submit = $('submit-button');\n\t\tkey_name   = $('key-name');\n\t\thint       = $('hint');\n\n\t\tform.addEventListener('submit', function(e) {\n\t\t\te.preventDefault();\n\t\t\tif (form.reportValidity()) {\n\t\t\t\tshowSpinner(true);\n\t\t\t\tdoRegister();\n\t\t\t}\n\t\t});\n\n\t\tdocument.querySelector('table.widefat > tbody').addEventListener('click', function(e) {\n\t\t\tvar target = e.target;\n\t\t\twhile (target !== null && (!target.tagName || target.tagName.toUpperCase() !== 'BUTTON' || target.className.indexOf('revoke-button') === -1)) {\n\t\t\t\ttarget = target.parentNode;\n\t\t\t}\n\n\t\t\tif (target && confirm(wwU2F.revconfirm)) {\n\t\t\t\tvar handle = target.dataset.handle;\n\t\t\t\tvar nonce  = target.dataset.nonce;\n\t\t\t\tvar req    = new XMLHttpRequest();\n\t\t\t\treq.tgt    = target;\n\t\t\t\treq.addEventListener('load', revokeCompleted);\n\n\t\t\t\tvar spinner = target.querySelector('.spinner');\n\t\t\t\tspinner.style.float = 'none';\n\t\t\t\tspinner.style.margin = 0;\n\t\t\t\tspinner.classList.add('is-active');\n\t\t\t\thideMessages();\n\n\t\t\t\treq.open('POST', ajaxurl);\n\t\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\t\treq.responseType = 'json';\n\t\t\t\treq.send(\n\t\t\t\t\t  'action=wwu2f_revoke'\n\t\t\t\t\t+ '&handle=' + encodeURIComponent(handle) \n\t\t\t\t\t+ '&_wpnonce=' + nonce\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tif (typeof u2f === 'undefined' || !u2f.register) {\n\t\t\tshowError(wwU2F.noSupport, 'new-key');\n\t\t}\n\t}\n\n\tfunction callback() {\n\t\tif (typeof u2f === 'undefined' || !u2f.register) {\n\t\t\tvar s = document.createElement('script');\n\t\t\ts.setAttribute('src', wwU2F.u2f_api);\n\t\t\ts.setAttribute('async', '');\n\t\t\ts.addEventListener('load', magic);\n\t\t\ts.addEventListener('error', magic);\n\t\t\tdocument.head.appendChild(s);\n\t\t}\n\t\telse {\n\t\t\tmagic();\n\t\t}\n\t}\n\n\tif (document.readyState === 'loading') {\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\n\t}\n\telse {\n\t\tcallback();\n\t}\n}());\n"]}