{"version":3,"sources":["u2flogin.js"],"names":["magic","$","document","getElementById","bind","form","submit","querySelector","pbar","lerr","showError","msg","firstChild","removeChild","insertAdjacentHTML","removeAttribute","requestCompleted","this","response","status","wwU2F","serverError","setAttribute","ok","redirect","window","location","href","message","style","display","innerHTML","doSign","u2f","sign","request","appId","challenge","data","errorCode","code","errors","remember","encodeURIComponent","value","user_id","interim_login","req","XMLHttpRequest","addEventListener","open","ajax_url","setRequestHeader","responseType","send","JSON","stringify","e","preventDefault","noSupport","s","createElement","u2f_api","head","appendChild"],"mappings":"AACA,SAASA,QAER,IAAIC,EAASC,SAASC,eAAeC,KAAKF,UACtCG,EAASJ,EAAE,YACXK,EAASD,EAAKE,cAAc,YAC5BC,EAASP,EAAE,eACXQ,EAASR,EAAE,eAEf,SAASS,EAAUC,GAElB,KAAOF,EAAKG,YACXH,EAAKI,YAAYJ,EAAKG,YAGvBH,EAAKK,mBAAmB,aAAcH,GACtCF,EAAKM,gBAAgB,UAGtB,SAASC,IAER,GAAI,OAASC,KAAKC,UAA4B,MAAhBD,KAAKE,OAIlC,OAHAT,EAAUU,MAAMC,aAChBf,EAAOS,gBAAgB,eACvBP,EAAKc,aAAa,SAAU,IAIzBL,KAAKC,SAASK,GACbN,KAAKC,SAASM,SACjBC,OAAOC,SAASC,KAAOV,KAAKC,SAASM,SAE7BP,KAAKC,SAASU,UACtB1B,SAASK,cAAc,0BAA0BsB,MAAMC,QAAU,OACjE7B,EAAE,YAAY8B,UAAYd,KAAKC,SAASU,UAIzClB,EAAUO,KAAKC,SAASU,SACxBtB,EAAOS,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,KAI9B,SAASU,IAER3B,EAAKU,gBAAgB,UACrBN,EAAKa,aAAa,SAAU,IAC5BW,IAAIC,KAAKd,MAAMe,QAAQ,GAAGC,MAAOhB,MAAMe,QAAQ,GAAGE,UAAWjB,MAAMe,QAAS,SAASG,GACpF,GAAIA,EAAKC,UAAW,CACnB,IAAIC,EAAOpB,MAAMqB,OAAOH,EAAKC,YAAc,EAC3C7B,EAAUU,MAAMqB,OAAOD,IACvBlC,EAAOS,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,QAExB,CACJ,IAAIoB,EAAgBC,mBAAmB1C,EAAE,cAAc2C,OACnDpB,EAAgBmB,mBAAmB1C,EAAE,eAAe2C,OACpDC,EAAgBF,mBAAmB1C,EAAE,WAAW2C,OAChDE,EAAgBH,mBAAmB1C,EAAE,iBAAiB2C,OACtDG,EAAM,IAAIC,eACdD,EAAIE,iBAAiB,OAAQjC,GAC7B+B,EAAIG,KAAK,OAAQ9B,MAAM+B,UACvBJ,EAAIK,iBAAiB,eAAgB,qCACrCL,EAAIM,aAAe,OACnBN,EAAIO,KACA,0BACUX,mBAAmBY,KAAKC,UAAUlB,IAC7C,eAAiBI,EACjB,gBAAkBlB,EAClB,YAAcqB,EACd,kBAAoBC,MAM1BzC,EAAK4C,iBAAiB,SAAU,SAASQ,GACxCA,EAAEC,mBAGgB,oBAARzB,KAAwBA,IAAIC,MAKvC5B,EAAOC,cAAc,WAAW0C,iBAAiB,QAAS,WACzDzC,EAAKO,gBAAgB,UACrBT,EAAOgB,aAAa,SAAU,IAC9BU,MAGD/B,EAAE,YAAYc,gBAAgB,UAC9BiB,KAXCtB,EAAUU,MAAMuC,WAclBzD,SAAS+C,iBAAiB,mBAAoB,WAC7C,GAAmB,oBAARhB,KAAwBA,IAAIC,KAStClC,YAT4C,CAC5C,IAAI4D,EAAI1D,SAAS2D,cAAc,UAC/BD,EAAEtC,aAAa,MAAOF,MAAM0C,SAC5BF,EAAEtC,aAAa,QAAS,IACxBsC,EAAEX,iBAAiB,OAAQjD,OAC3B4D,EAAEX,iBAAiB,QAASjD,OAC5BE,SAAS6D,KAAKC,YAAYJ","file":"u2flogin.min.js","sourcesContent":["/** global u2f, wwU2F */\nfunction magic()\n{\n\tvar $      = document.getElementById.bind(document);\n\tvar form   = $('u2f-form');\n\tvar submit = form.querySelector('p.submit');\n\tvar pbar   = $('progressbar');\n\tvar lerr   = $('login_error');\n\n\tfunction showError(msg)\n\t{\n\t\twhile (lerr.firstChild) {\n\t\t\tlerr.removeChild(lerr.firstChild);\n\t\t}\n\n\t\tlerr.insertAdjacentHTML('afterbegin', msg);\n\t\tlerr.removeAttribute('hidden');\n\t}\n\n\tfunction requestCompleted()\n\t{\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\tif (this.response.redirect) {\n\t\t\t\twindow.location.href = this.response.redirect;\n\t\t\t}\n\t\t\telse if (this.response.message) {\n\t\t\t\tdocument.querySelector('.progressbar-container').style.display = 'none';\n\t\t\t\t$('interact').innerHTML = this.response.message;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t}\n\t}\n\n\tfunction doSign()\n\t{\n\t\tform.removeAttribute('hidden');\n\t\tlerr.setAttribute('hidden', '');\n\t\tu2f.sign(wwU2F.request[0].appId, wwU2F.request[0].challenge, wwU2F.request, function(data) {\n\t\t\tif (data.errorCode) {\n\t\t\t\tvar code = wwU2F.errors[data.errorCode] || 1;\n\t\t\t\tshowError(wwU2F.errors[code]);\n\t\t\t\tsubmit.removeAttribute('hidden');\n\t\t\t\tpbar.setAttribute('hidden', '');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar remember      = encodeURIComponent($('rememberme').value);\n\t\t\t\tvar redirect      = encodeURIComponent($('redirect_to').value);\n\t\t\t\tvar user_id       = encodeURIComponent($('user_id').value);\n\t\t\t\tvar interim_login = encodeURIComponent($('interim_login').value);\n\t\t\t\tvar req = new XMLHttpRequest();\n\t\t\t\treq.addEventListener('load', requestCompleted);\n\t\t\t\treq.open('POST', wwU2F.ajax_url);\n\t\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\t\treq.responseType = 'json';\n\t\t\t\treq.send(\n\t\t\t\t\t   'action=wwu2f_sign'\n\t\t\t\t\t+ '&data=' + encodeURIComponent(JSON.stringify(data))\n\t\t\t\t\t+ '&rememberme=' + remember\n\t\t\t\t\t+ '&redirect_to=' + redirect\n\t\t\t\t\t+ '&user_id=' + user_id\n\t\t\t\t\t+ '&interim_login=' + interim_login\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\tform.addEventListener('submit', function(e) {\n\t\te.preventDefault();\n\t});\n\n\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\tshowError(wwU2F.noSupport);\n\t\treturn;\n\t}\n\n\tsubmit.querySelector('.button').addEventListener('click', function() {\n\t\tpbar.removeAttribute('hidden');\n\t\tsubmit.setAttribute('hidden', '');\n\t\tdoSign();\n\t});\n\n\t$('interact').removeAttribute('hidden');\n\tdoSign();\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\tvar s = document.createElement('script');\n\t\ts.setAttribute('src', wwU2F.u2f_api);\n\t\ts.setAttribute('async', '');\n\t\ts.addEventListener('load', magic);\n\t\ts.addEventListener('error', magic);\n\t\tdocument.head.appendChild(s);\n\t}\n\telse {\n\t\tmagic();\n\t}\n});\n"]}