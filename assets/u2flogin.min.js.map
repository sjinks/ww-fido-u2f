{"version":3,"sources":["u2flogin.js"],"names":["$","form","submit","pbar","lerr","showError","msg","firstChild","removeChild","insertAdjacentHTML","removeAttribute","requestCompleted","this","response","status","wwU2F","serverError","setAttribute","ok","redirect","window","location","href","message","document","querySelector","style","display","innerHTML","signCallback","data","errorCode","errors","remember","encodeURIComponent","value","user_id","interim_login","req","XMLHttpRequest","addEventListener","open","ajax_url","setRequestHeader","responseType","send","JSON","stringify","doSign","u2f","sign","request","appId","challenge","magic","getElementById","bind","e","preventDefault","noSupport","callback","s","createElement","u2f_api","head","appendChild","readyState"],"mappings":"CACA,WACC,IAAIA,EAAGC,EAAMC,EAAQC,EAAMC,EAE3B,SAASC,EAAUC,GAElB,KAAOF,EAAKG,YACXH,EAAKI,YAAYJ,EAAKG,YAGvBH,EAAKK,mBAAmB,aAAcH,GACtCF,EAAKM,gBAAgB,UAGtB,SAASC,IAER,GAAI,OAASC,KAAKC,UAA4B,MAAhBD,KAAKE,OAIlC,OAHAT,EAAUU,MAAMC,aAChBd,EAAOQ,gBAAgB,eACvBP,EAAKc,aAAa,SAAU,IAIzBL,KAAKC,SAASK,GACbN,KAAKC,SAASM,SACjBC,OAAOC,SAASC,KAAOV,KAAKC,SAASM,SAE7BP,KAAKC,SAASU,UACtBC,SAASC,cAAc,0BAA0BC,MAAMC,QAAU,OACjE3B,EAAE,YAAY4B,UAAYhB,KAAKC,SAASU,UAIzClB,EAAUO,KAAKC,SAASU,SACxBrB,EAAOQ,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,KAI9B,SAASY,EAAaC,GAErB,GAAIA,EAAKC,UAAW,CAEnB1B,EADUU,MAAMiB,OAAOF,EAAKC,YAAchB,MAAMiB,OAAO,IAEvD9B,EAAOQ,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,QAExB,CACJ,IAAIgB,EAAgBC,mBAAmBlC,EAAE,cAAcmC,OACnDhB,EAAgBe,mBAAmBlC,EAAE,eAAemC,OACpDC,EAAgBF,mBAAmBlC,EAAE,WAAWmC,OAChDE,EAAgBH,mBAAmBlC,EAAE,iBAAiBmC,OACtDG,EAAM,IAAIC,eACdD,EAAIE,iBAAiB,OAAQ7B,GAC7B2B,EAAIG,KAAK,OAAQ1B,MAAM2B,UACvBJ,EAAIK,iBAAiB,eAAgB,qCACrCL,EAAIM,aAAe,OACnBN,EAAIO,KACA,0BACUX,mBAAmBY,KAAKC,UAAUjB,IAC7C,eAAiBG,EACjB,gBAAkBd,EAClB,YAAciB,EACd,kBAAoBC,IAKzB,SAASW,IAER/C,EAAKS,gBAAgB,UACrBN,EAAKa,aAAa,SAAU,IAC5BgC,IAAIC,KAAKnC,MAAMoC,QAAQ,GAAGC,MAAOrC,MAAMoC,QAAQ,GAAGE,UAAWtC,MAAMoC,QAAStB,GAG7E,SAASyB,IAERtD,EAASwB,SAAS+B,eAAeC,KAAKhC,UACtCvB,EAASD,EAAE,YACXE,EAASD,EAAKwB,cAAc,YAC5BtB,EAASH,EAAE,eACXI,EAASJ,EAAE,eAEXC,EAAKuC,iBAAiB,SAAU,SAASiB,GACxCA,EAAEC,mBAGgB,oBAART,KAAwBA,IAAIC,MAKvChD,EAAOuB,cAAc,WAAWe,iBAAiB,QAAS,WACzDrC,EAAKO,gBAAgB,UACrBR,EAAOe,aAAa,SAAU,IAC9B+B,MAGDhD,EAAE,YAAYU,gBAAgB,UAC9BsC,KAXC3C,EAAUU,MAAM4C,WAclB,SAASC,IAER,GAAmB,oBAARX,KAAwBA,IAAIC,KAStCI,QAT4C,CAC5C,IAAIO,EAAIrC,SAASsC,cAAc,UAC/BD,EAAE5C,aAAa,MAAOF,MAAMgD,SAC5BF,EAAE5C,aAAa,QAAS,IACxB4C,EAAErB,iBAAiB,OAAQc,GAC3BO,EAAErB,iBAAiB,QAASc,GAC5B9B,SAASwC,KAAKC,YAAYJ,IAOA,YAAxBrC,SAAS0C,WACZ1C,SAASgB,iBAAiB,mBAAoBoB,GAG9CA,IAxHF","file":"u2flogin.min.js","sourcesContent":["/** global u2f, wwU2F */\n(function() {\n\tvar $, form, submit, pbar, lerr;\n\n\tfunction showError(msg)\n\t{\n\t\twhile (lerr.firstChild) {\n\t\t\tlerr.removeChild(lerr.firstChild);\n\t\t}\n\n\t\tlerr.insertAdjacentHTML('afterbegin', msg);\n\t\tlerr.removeAttribute('hidden');\n\t}\n\n\tfunction requestCompleted()\n\t{\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\tif (this.response.redirect) {\n\t\t\t\twindow.location.href = this.response.redirect;\n\t\t\t}\n\t\t\telse if (this.response.message) {\n\t\t\t\tdocument.querySelector('.progressbar-container').style.display = 'none';\n\t\t\t\t$('interact').innerHTML = this.response.message;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t}\n\t}\n\n\tfunction signCallback(data)\n\t{\n\t\tif (data.errorCode) {\n\t\t\tvar err = wwU2F.errors[data.errorCode] || wwU2F.errors[1];\n\t\t\tshowError(err);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t}\n\t\telse {\n\t\t\tvar remember      = encodeURIComponent($('rememberme').value);\n\t\t\tvar redirect      = encodeURIComponent($('redirect_to').value);\n\t\t\tvar user_id       = encodeURIComponent($('user_id').value);\n\t\t\tvar interim_login = encodeURIComponent($('interim_login').value);\n\t\t\tvar req = new XMLHttpRequest();\n\t\t\treq.addEventListener('load', requestCompleted);\n\t\t\treq.open('POST', wwU2F.ajax_url);\n\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\treq.responseType = 'json';\n\t\t\treq.send(\n\t\t\t\t   'action=wwu2f_sign'\n\t\t\t\t+ '&data=' + encodeURIComponent(JSON.stringify(data))\n\t\t\t\t+ '&rememberme=' + remember\n\t\t\t\t+ '&redirect_to=' + redirect\n\t\t\t\t+ '&user_id=' + user_id\n\t\t\t\t+ '&interim_login=' + interim_login\n\t\t\t);\n\t\t}\n\t}\n\n\tfunction doSign()\n\t{\n\t\tform.removeAttribute('hidden');\n\t\tlerr.setAttribute('hidden', '');\n\t\tu2f.sign(wwU2F.request[0].appId, wwU2F.request[0].challenge, wwU2F.request, signCallback);\n\t}\n\n\tfunction magic()\n\t{\n\t\t$      = document.getElementById.bind(document);\n\t\tform   = $('u2f-form');\n\t\tsubmit = form.querySelector('p.submit');\n\t\tpbar   = $('progressbar');\n\t\tlerr   = $('login_error');\n\n\t\tform.addEventListener('submit', function(e) {\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\t\tshowError(wwU2F.noSupport);\n\t\t\treturn;\n\t\t}\n\n\t\tsubmit.querySelector('.button').addEventListener('click', function() {\n\t\t\tpbar.removeAttribute('hidden');\n\t\t\tsubmit.setAttribute('hidden', '');\n\t\t\tdoSign();\n\t\t});\n\n\t\t$('interact').removeAttribute('hidden');\n\t\tdoSign();\n\t}\n\n\tfunction callback()\n\t{\n\t\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\t\tvar s = document.createElement('script');\n\t\t\ts.setAttribute('src', wwU2F.u2f_api);\n\t\t\ts.setAttribute('async', '');\n\t\t\ts.addEventListener('load', magic);\n\t\t\ts.addEventListener('error', magic);\n\t\t\tdocument.head.appendChild(s);\n\t\t}\n\t\telse {\n\t\t\tmagic();\n\t\t}\n\t}\n\n\tif (document.readyState === 'loading') {\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\n\t}\n\telse {\n\t\tcallback();\n\t}\n})();\n"]}