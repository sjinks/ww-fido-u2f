{"version":3,"sources":["u2flogin.js"],"names":["magic","form","document","getElementById","submit","querySelector","pbar","lerr","showError","msg","firstChild","removeChild","insertAdjacentHTML","removeAttribute","requestCompleted","this","response","status","wwU2F","serverError","setAttribute","ok","redirect","window","location","href","message","style","display","innerHTML","doSign","u2f","sign","request","appId","challenge","data","errorCode","code","errors","remember","encodeURIComponent","value","user_id","interim_login","req","XMLHttpRequest","addEventListener","open","ajax_url","setRequestHeader","responseType","send","JSON","stringify","e","preventDefault","noSupport","s","createElement","u2f_api","head","appendChild"],"mappings":"AACA,SAASA,QACR,IAAIC,EAASC,SAASC,eAAe,YACjCC,EAASH,EAAKI,cAAc,YAC5BC,EAASJ,SAASC,eAAe,eACjCI,EAASL,SAASC,eAAe,eAErC,SAASK,EAAUC,GAElB,KAAOF,EAAKG,YACXH,EAAKI,YAAYJ,EAAKG,YAGvBH,EAAKK,mBAAmB,aAAcH,GACtCF,EAAKM,gBAAgB,UAGtB,SAASC,IAER,GAAI,OAASC,KAAKC,UAA4B,MAAhBD,KAAKE,OAIlC,OAHAT,EAAUU,MAAMC,aAChBf,EAAOS,gBAAgB,eACvBP,EAAKc,aAAa,SAAU,IAIzBL,KAAKC,SAASK,GACbN,KAAKC,SAASM,SACjBC,OAAOC,SAASC,KAAOV,KAAKC,SAASM,SAE7BP,KAAKC,SAASU,UACtBxB,SAASC,eAAe,yBAAyBwB,MAAMC,QAAU,OACjE1B,SAASC,eAAe,YAAY0B,UAAYd,KAAKC,SAASU,UAI/DlB,EAAUO,KAAKC,SAASU,SACxBtB,EAAOS,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,KAI9B,SAASU,IAER7B,EAAKY,gBAAgB,UACrBN,EAAKa,aAAa,SAAU,IAC5BW,IAAIC,KAAKd,MAAMe,QAAQ,GAAGC,MAAOhB,MAAMe,QAAQ,GAAGE,UAAWjB,MAAMe,QAAS,SAASG,GACpF,GAAIA,EAAKC,UAAW,CACnB,IAAIC,EAAOpB,MAAMqB,OAAOH,EAAKC,YAAc,EAC3C7B,EAAUU,MAAMqB,OAAOD,IACvBlC,EAAOS,gBAAgB,UACvBP,EAAKc,aAAa,SAAU,QAExB,CACJ,IAAIoB,EAAgBC,mBAAmBvC,SAASC,eAAe,cAAcuC,OACzEpB,EAAgBmB,mBAAmBvC,SAASC,eAAe,eAAeuC,OAC1EC,EAAgBF,mBAAmBvC,SAASC,eAAe,WAAWuC,OACtEE,EAAgBH,mBAAmBvC,SAASC,eAAe,iBAAiBuC,OAC5EG,EAAM,IAAIC,eACdD,EAAIE,iBAAiB,OAAQjC,GAC7B+B,EAAIG,KAAK,OAAQ9B,MAAM+B,UACvBJ,EAAIK,iBAAiB,eAAgB,qCACrCL,EAAIM,aAAe,OACnBN,EAAIO,KACA,0BACUX,mBAAmBY,KAAKC,UAAUlB,IAC7C,eAAiBI,EACjB,gBAAkBlB,EAClB,YAAcqB,EACd,kBAAoBC,MAM1B3C,EAAK8C,iBAAiB,SAAU,SAASQ,GACxCA,EAAEC,mBAGgB,oBAARzB,KAAwBA,IAAIC,MAKvC5B,EAAOC,cAAc,WAAW0C,iBAAiB,QAAS,WACzDzC,EAAKO,gBAAgB,UACrBT,EAAOgB,aAAa,SAAU,IAC9BU,MAGD5B,SAASC,eAAe,YAAYU,gBAAgB,UACpDiB,KAXCtB,EAAUU,MAAMuC,WAclBvD,SAAS6C,iBAAiB,mBAAoB,WAC7C,GAAmB,oBAARhB,KAAwBA,IAAIC,KAStChC,YAT4C,CAC5C,IAAI0D,EAAIxD,SAASyD,cAAc,UAC/BD,EAAEtC,aAAa,MAAOF,MAAM0C,SAC5BF,EAAEtC,aAAa,QAAS,IACxBsC,EAAEX,iBAAiB,OAAQ/C,OAC3B0D,EAAEX,iBAAiB,QAAS/C,OAC5BE,SAAS2D,KAAKC,YAAYJ","file":"u2flogin.min.js","sourcesContent":["/** global u2f, wwU2F */\nfunction magic() {\n\tvar form   = document.getElementById('u2f-form');\n\tvar submit = form.querySelector('p.submit');\n\tvar pbar   = document.getElementById('progressbar');\n\tvar lerr   = document.getElementById('login_error');\n\n\tfunction showError(msg)\n\t{\n\t\twhile (lerr.firstChild) {\n\t\t\tlerr.removeChild(lerr.firstChild);\n\t\t}\n\n\t\tlerr.insertAdjacentHTML('afterbegin', msg);\n\t\tlerr.removeAttribute('hidden');\n\t}\n\n\tfunction requestCompleted()\n\t{\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (this.response.ok) {\n\t\t\tif (this.response.redirect) {\n\t\t\t\twindow.location.href = this.response.redirect;\n\t\t\t}\n\t\t\telse if (this.response.message) {\n\t\t\t\tdocument.getElementById('progressbar-container').style.display = 'none';\n\t\t\t\tdocument.getElementById('interact').innerHTML = this.response.message;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message);\n\t\t\tsubmit.removeAttribute('hidden');\n\t\t\tpbar.setAttribute('hidden', '');\n\t\t}\n\t}\n\n\tfunction doSign()\n\t{\n\t\tform.removeAttribute('hidden');\n\t\tlerr.setAttribute('hidden', '');\n\t\tu2f.sign(wwU2F.request[0].appId, wwU2F.request[0].challenge, wwU2F.request, function(data) {\n\t\t\tif (data.errorCode) {\n\t\t\t\tvar code = wwU2F.errors[data.errorCode] || 1;\n\t\t\t\tshowError(wwU2F.errors[code]);\n\t\t\t\tsubmit.removeAttribute('hidden');\n\t\t\t\tpbar.setAttribute('hidden', '');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar remember      = encodeURIComponent(document.getElementById('rememberme').value);\n\t\t\t\tvar redirect      = encodeURIComponent(document.getElementById('redirect_to').value);\n\t\t\t\tvar user_id       = encodeURIComponent(document.getElementById('user_id').value);\n\t\t\t\tvar interim_login = encodeURIComponent(document.getElementById('interim_login').value);\n\t\t\t\tvar req = new XMLHttpRequest();\n\t\t\t\treq.addEventListener('load', requestCompleted);\n\t\t\t\treq.open('POST', wwU2F.ajax_url);\n\t\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\t\treq.responseType = 'json';\n\t\t\t\treq.send(\n\t\t\t\t\t   'action=wwu2f_sign'\n\t\t\t\t\t+ '&data=' + encodeURIComponent(JSON.stringify(data))\n\t\t\t\t\t+ '&rememberme=' + remember\n\t\t\t\t\t+ '&redirect_to=' + redirect\n\t\t\t\t\t+ '&user_id=' + user_id\n\t\t\t\t\t+ '&interim_login=' + interim_login\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\tform.addEventListener('submit', function(e) {\n\t\te.preventDefault();\n\t});\n\n\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\tshowError(wwU2F.noSupport);\n\t\treturn;\n\t}\n\n\tsubmit.querySelector('.button').addEventListener('click', function() {\n\t\tpbar.removeAttribute('hidden');\n\t\tsubmit.setAttribute('hidden', '');\n\t\tdoSign();\n\t});\n\n\tdocument.getElementById('interact').removeAttribute('hidden');\n\tdoSign();\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n\tif (typeof u2f === 'undefined' || !u2f.sign) {\n\t\tvar s = document.createElement('script');\n\t\ts.setAttribute('src', wwU2F.u2f_api);\n\t\ts.setAttribute('async', '');\n\t\ts.addEventListener('load', magic);\n\t\ts.addEventListener('error', magic);\n\t\tdocument.head.appendChild(s);\n\t}\n\telse {\n\t\tmagic();\n\t}\n});\n"]}